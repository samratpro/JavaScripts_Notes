## First: Install required dependencies
```bash
npm install csv-parser csv-writer
npm install --save-dev @types/node
npm install csv-stringify # lightweight built-in + popular libraries:
```
## Text File Operations (.txt)
```ts
import * as fs from 'fs/promises';
import * as path from 'path';

// Ensure directory exists
async function ensureDir(filePath: string) {
  await fs.mkdir(path.dirname(filePath), { recursive: true });
}

// Write (overwrite)
export async function writeTextFile(filePath: string, content: string): Promise<void> {
  await ensureDir(filePath);
  await fs.writeFile(filePath, content, 'utf-8');
}

// Append to text file
export async function appendTextFile(filePath: string, content: string): Promise<void> {
  await ensureDir(filePath);
  await fs.appendFile(filePath, content + '\n', 'utf-8');
}

// Read entire text file
export async function readTextFile(filePath: string): Promise<string> {
  return await fs.readFile(filePath, 'utf-8');
}

// Read file line by line (streaming)
export async function* readTextFileLines(filePath: string): AsyncGenerator<string> {
  const file = await fs.readFile(filePath, 'utf-8');
  for (const line of file.split(/\r?\n/)) {
    if (line.trim() !== '') yield line;
  }
}

```
## Define your data type (example) for csv
```ts
interface Person {
  name: string;
  age: number;
  city: string;
}
```
## Write CSV (create or overwrite)
```ts
import { createObjectCsvWriter } from 'csv-writer';

export async function writeCsvFile<T extends Record<string, any>>(
  filePath: string,
  records: T[],
  header: { id: keyof T; title: string }[]
): Promise<void> {
  await ensureDir(filePath);

  const csvWriter = createObjectCsvWriter({
    path: filePath,
    header,
  });

  await csvWriter.writeRecords(records);
}
```
## Append to existing CSV
```ts
import { createObjectCsvWriter } from 'csv-writer';

export async function appendToCsvFile<T extends Record<string, any>>(
  filePath: string,
  records: T[],
  header: { id: keyof T; title: string }[]
): Promise<void> {
  await ensureDir(filePath);

  const csvWriter = createObjectCsvWriter({
    path: filePath,
    header,
    append: true, // This enables append mode
  });

  await csvWriter.writeRecords(records);
}
```
## Read CSV File
```ts
import * as fs from 'fs';
import csvParser from 'csv-parser';

export function readCsvFile<T = any>(filePath: string): Promise<T[]> {
  return new Promise((resolve, reject) => {
    const results: T[] = [];

    if (!fs.existsSync(filePath)) {
      resolve([]);
      return;
    }

    fs.createReadStream(filePath)
      .pipe(csvParser())
      .on('data', (data) => results.push(data))
      .on('end', () => resolve(results))
      .on('error', reject);
  });
}
```
## Example Usage
```ts
async function main() {
  const txtFile = './data/log.txt';
  const csvFile = './data/people.csv';

  // Text file examples
  await writeTextFile(txtFile, 'Hello TypeScript!\n');
  await appendTextFile(txtFile, 'Second line');
  await appendTextFile(txtFile, 'Third line');

  const content = await readTextFile(txtFile);
  console.log('Text file content:\n', content);

  // CSV examples
  const header = [
    { id: 'name', title: 'Name' },
    { id: 'age', title: 'Age' },
    { id: 'city', title: 'City' },
  ];

  const people: Person[] = [
    { name: 'Alice', age: 25, city: 'New York' },
    { name: 'Bob', age: 30, city: 'London' },
  ];

  await writeCsvFile(csvFile, people, header);
  await appendToCsvFile(csvFile, [{ name: 'Charlie', age: 35, city: 'Paris' }], header);

  const loadedPeople = await readCsvFile<Person>(csvFile);
  console.log('CSV data:', loadedPeople);
}

main().catch(console.error);
```
## Lightweight CSV without external deps (using csv-parse/stringify)
```ts
import { parse } from 'csv-parse/sync';
import { stringify } from 'csv-stringify/sync';
import * as fs from 'fs/promises';

async function writeCsvSimple(filePath: string, data: any[][]) {
  const csv = stringify(data, { header: true });
  await fs.writeFile(filePath, csv);
}
```
## Real-World Scraper Example
```ts
// scraper.ts
import { appendCSVRow, readAndLoopCSV, writeCSV, readCSV } from './csv';

interface Product {
  title: string;
  price: string;
  url: string;
  date: string;
}

const FILE = './output/products.csv';

async function scrapeAndSave() {
  console.log('Scraping started...');

  // Example: scraping 5 products one by one
  const products = [
    { title: 'iPhone 16', price: '$999', url: 'https://apple.com/1', date: new Date().toISOString() },
    { title: 'Samsung S24', price: '$899', url: 'https://samsung.com/1', date: new Date().toISOString() },
    { title: 'MacBook Pro', price: '$2499', url: 'https://apple.com/2', date: new Date().toISOString() },
  ];

  for (const product of products) {
    await appendCSVRow(FILE, product);  // Appends 1 row at a time → safe & fast
    console.log(`Saved: ${product.title}`);
    // await fakeNetworkDelay(); // simulate real scraping delay
  }

  console.log('All saved!');
}

async function showAllData() {
  console.log('\nReading all saved products:');
  const data = await readCSV<Product>(FILE);
  console.table(data);
}

async function processEachRow() {
  console.log('\nProcessing each row one by one:');
  await readAndLoopCSV<Product>(FILE, (row, index) => {
    console.log(`${index + 1}. ${row.title} → ${row.price}`);
  });
}

// Run examples
async function main() {
  await scrapeAndSave();
  await showAllData();
  await processEachRow();

  // Or overwrite everything
  // await writeCSV(FILE, [{ title: 'New Phone', price: '$100', url: '...', date: '...' }]);
}

main().catch(console.error);
```

