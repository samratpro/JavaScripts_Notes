## Install
```bash
npm install csv-stringify csv-parse
npm install --save-dev @types/node
```
## 00. utils/progress.ts
```ts
import fs from 'fs/promises';
import path from 'path';

async function ensureDir(filePath: string): Promise<void> {
  await fs.mkdir(path.dirname(filePath), { recursive: true });
}

async function appendTextFile(filePath: string, content: string): Promise<void> {
  await ensureDir(filePath);
  await fs.appendFile(filePath, content + '\n', 'utf-8');
}

// Save progress to disk
async function saveProgress(currentPage: number, totalPages: number, PROGRESS_FILE: string ) {
  await ensureDir(PROGRESS_FILE);
  await fs.writeFile(PROGRESS_FILE, JSON.stringify({ currentPage, totalPages }, null, 2));
}

// Load progress (returns start page)
async function loadProgress(totalPages: number, PROGRESS_FILE : string): Promise<number> {
  try {
    const data = await fs.readFile(PROGRESS_FILE, 'utf-8');
    const json = JSON.parse(data);
    if (json.currentPage >= 1 && json.currentPage <= totalPages) {
      console.log(`Resuming from page ${json.currentPage + 1}`);
      return json.currentPage + 1;
    }
  } catch (err) {
    // No progress file → start from beginning
  }
  return 1;
}
```

## 01. utils/text.ts – Text File Utils
```ts
import fs from 'fs/promises';
import path from 'path';

// ─────────────────────────────────────
// Shared: Ensure directory exists
export async function ensureDir(filePath: string): Promise<void> {
  await fs.mkdir(path.dirname(filePath), { recursive: true });
}
// ─────────────────────────────────────
// Progress Management
export interface Progress {
  currentPage: number;
  totalPages?: number;
  lastRun?: string;
}
// ─────────────────────────────────────
// Text file operations
export async function writeTextFile(filePath: string, content: string): Promise<void> {
  await ensureDir(filePath);
  await fs.writeFile(filePath, content, 'utf-8');
}

export async function appendTextFile(filePath: string, content: string): Promise<void> {
  await ensureDir(filePath);
  await fs.appendFile(filePath, content + '\n', 'utf-8');
}

export async function readTextFile(filePath: string): Promise<string> {
  return await fs.readFile(filePath, 'utf-8');
}
```

## 02. utils/csv.ts – Fast CSV Utils (2025 Standard)
```ts
import fs from 'fs/promises';
import path from 'path';
import { stringify } from 'csv-stringify/sync';
import { parse } from 'csv-parse/sync'; // ← sync is best for reading

// ─────────────────────────────────────
// Shared: Ensure dir + Progress
export async function ensureDir(filePath: string): Promise<void> {
  await fs.mkdir(path.dirname(filePath), { recursive: true });
}

export interface Progress {
  currentPage: number;
  lastRun?: string;
}
// ─────────────────────────────────────
// CSV: Write / Overwrite
export async function writeCsvFile<T extends Record<string, any>>(
  filePath: string,
  records: T[],
  header: { id: keyof T; title: string }[]
): Promise<void> {
  await ensureDir(filePath);
  const columns = header.map(h => ({ key: h.id as string, header: h.title }));
  const csv = stringify(records, { header: true, columns });
  await fs.writeFile(filePath, csv, 'utf-8');
}

// ─────────────────────────────────────
// CSV: Append
export async function appendToCsvFile<T extends Record<string, any>>(
  filePath: string,
  records: T[],
  header: { id: keyof T; title: string }[]
): Promise<void> {
  await ensureDir(filePath);
  const fileExists = await fs.stat(filePath).then(() => true).catch(() => false);
  const columns = header.map(h => ({ key: h.id as string, header: h.title }));
  const csv = stringify(records, { header: !fileExists, columns });
  await fs.appendFile(filePath, csv, 'utf-8');
}

// ─────────────────────────────────────
// CSV: Read – SIMPLE, FAST, NO ERRORS, 2025 STANDARD
export async function readCsvFile<T extends Record<string, any>>(
  filePath: string
): Promise<T[]> {
  try {
    const content = await fs.readFile(filePath, 'utf-8');

    // This is the correct return — NOT the parser!
    return parse(content, {
      columns: true,
      skip_empty_lines: true,
      trim: true,
    }) as T[];
  } catch (err: any) {
    if (err.code === 'ENOENT') {
      return []; // File doesn't exist → return empty array
    }
    throw err; // Other errors (corrupted file, etc.)
  }
}
```
## 03. utils/json.ts – JSON Utils (Perfect for Scrapers)
```ts
import fs from 'fs/promises';
import path from 'path';

// ─────────────────────────────────────
// Shared: Ensure dir + Progress
export async function ensureDir(filePath: string): Promise<void> {
  await fs.mkdir(path.dirname(filePath), { recursive: true });
}

// ─────────────────────────────────────
// JSON Helpers
export async function readJson<T>(filePath: string, defaultValue: T): Promise<T> {
  try {
    const data = await fs.readFile(filePath, 'utf-8');
    return JSON.parse(data) as T;
  } catch (err: any) {
    if (err.code === 'ENOENT') return defaultValue;
    throw err;
  }
}

export async function writeJson<T>(filePath: string, data: T): Promise<void> {
  await ensureDir(filePath);
  await fs.writeFile(filePath, JSON.stringify(data, null, 2), 'utf-8');
}

export async function appendJsonArray<T>(filePath: string, item: T): Promise<void> {
  const arr = await readJson<T[]>(filePath, []);
  arr.push(item);
  await writeJson(filePath, arr);
}

export async function updateJson<T extends object>(
  filePath: string,
  updater: (current: T) => T,
  defaultValue: T
): Promise<void> {
  const current = await readJson(filePath, defaultValue);
  await writeJson(filePath, updater(current));
}
```

## Example Uses
```ts
// scraper.ts
import { appendTextFile } from './utils/util-text';
import {
  appendToCsvFile,
  writeCsvFile,
  readCsvFile,
  loadProgress,
  saveProgress,
} from './utils/util-csv';
import {
  appendJsonArray,
  readJson,
  writeJson,
  loadProgress as loadJsonProgress,
  saveProgress as saveJsonProgress,
} from './utils/util-json';

// ─────────────────────────────────────
// 1. TEXT FILE: Save raw links (super fast)
async function exampleTextFile() {
  const file = 'data/links.txt';

  const fakeLinks = [
    'https://notaires.fr/notaire/12345',
    'https://notaires.fr/notaire/67890',
    'https://notaires.fr/notaire/abcde',
  ];

  for (const link of fakeLinks) {
    await appendTextFile(file, link);
    console.log('Saved link:', link);
  }

  console.log('All links saved to data/links.txt\n');
}

// ─────────────────────────────────────
// 2. CSV: Append scraped data + resume support
interface Notaire {
  name: string;
  city: string;
  phone: string;
  email: string;
  url: string;
}

const CSV_FILE = 'data/notaires.csv';
const PROGRESS_FILE = 'data/progress.json';

const header = [
  { id: 'name', title: 'Full Name' },
  { id: 'city', title: 'City' },
  { id: 'phone', title: 'Phone' },
  { id: 'email', title: 'Email' },
  { id: 'url', title: 'Profile URL' },
] as const;

async function exampleCsvWithResume() {
  const totalPages = 1932;
  let currentPage = await loadProgress(totalPages, PROGRESS_FILE);

  console.log(`Starting CSV scraping from page ${currentPage}...`);

  // Simulate scraping 10 pages
  for (; currentPage <= totalPages && currentPage <= currentPage + 9; currentPage++) {
    const fakeData: Notaire[] = [
      {
        name: `Notaire ${currentPage}A`,
        city: 'Paris',
        phone: '+33123456789',
        email: `contact${currentPage}a@notaire.fr`,
        url: `https://notaires.fr/notaire/${currentPage}a`,
      },
      {
        name: `Notaire ${currentPage}B`,
        city: 'Lyon',
        phone: '+33456789012',
        email: `contact${currentPage}b@notaire.fr`,
        url: `https://notaires.fr/notaire/${currentPage}b`,
      },
    ];

    await appendToCsvFile(CSV_FILE, fakeData, header);
    await saveProgress(PROGRESS_FILE, currentPage);

    console.log(`Page ${currentPage} saved → 2 notaires`);
  }

  console.log('CSV example done! Check data/notaires.csv\n');
}

// ─────────────────────────────────────
// 3. JSON: Save full objects + progress tracking
interface Product {
  title: string;
  price: string;
  url: string;
  scrapedAt: string;
}

const JSON_FILE = 'data/products.json';
const JSON_PROGRESS = 'data/json-progress.json';

async function exampleJsonAppend() {
  let page = await loadJsonProgress(100, JSON_PROGRESS);

  console.log(`Starting JSON append from page ${page}...`);

  for (; page <= page + 4; page++) {
    const product: Product = {
      title: `MacBook Pro ${page}`,
      price: '$' + (2000 + page * 10),
      url: `https://apple.com/macbook-${page}`,
      scrapedAt: new Date().toISOString(),
    };

    await appendJsonArray(JSON_FILE, product);
    await saveJsonProgress(JSON_PROGRESS, page);

    console.log(`Appended: ${product.title}`);
  }

  console.log('JSON example done! Check data/products.json\n');
}

// ─────────────────────────────────────
// 4. Read everything back
async function exampleReadAll() {
  console.log('=== READING ALL DATA BACK ===\n');

  // Read text file
  try {
    const content = await import('fs/promises').then(fs => fs.readFile('data/links.txt', 'utf-8'));
    console.log('Links from TXT:');
    console.log(content.trim());
  } catch {}

  // Read CSV
  const notaires = await readCsvFile<Notaire>(CSV_FILE);
  console.log(`\nLoaded ${notaires.length} notaires from CSV:`);
  console.table(notaires.slice(0, 3).map(n => ({ name: n.name, city: n.city })));

  // Read JSON
  const products = await readJson<Product[]>(JSON_FILE, []);
  console.log(`\nLoaded ${products.length} products from JSON:`);
  console.table(products.map(p => ({ title: p.title, price: p.price })));
}

// ─────────────────────────────────────
// Run everything
async function main() {
  await exampleTextFile();
  await exampleCsvWithResume();
  await exampleJsonAppend();
  await exampleReadAll();

  console.log('All examples completed! Check the data/ folder');
}

main().catch(console.error);
```

