## Install
```bash
npm install csv-stringify csv-parse
npm install --save-dev @types/node
```
## 00. utils/progress.ts
```ts
// utils/progress.ts
import fs from 'fs/promises';
import path from 'path';

export async function ensureDir(filePath: string): Promise<void> {
  const dir = path.dirname(filePath);
  if (dir) {
    await fs.mkdir(dir, { recursive: true });
  }
}

// Save current page (we only need currentPage — totalPages is optional)
export async function saveProgress(PROGRESS_FILE: string, currentPage: number): Promise<void> {
  const progress = {
    currentPage,
    savedAt: new Date().toISOString(),
  };
  await ensureDir(PROGRESS_FILE);
  await fs.writeFile(PROGRESS_FILE, JSON.stringify(progress, null, 2), 'utf-8');
}

// Load progress — returns the NEXT page to scrape
// If file doesn't exist or invalid → starts from page 1
export async function loadProgress(
  totalPages: number,
  PROGRESS_FILE: string
): Promise<number> {
  try {
    const data = await fs.readFile(PROGRESS_FILE, 'utf-8');
    const json = JSON.parse(data);

    // Validate that currentPage is a valid number and in range
    if (
      typeof json.currentPage === 'number' &&
      json.currentPage >= 1 &&
      json.currentPage <= totalPages
    ) {
      const nextPage = json.currentPage + 1;
      console.log(`Resuming from page ${nextPage} (last saved: ${json.currentPage})`);
      return nextPage;
    }
  } catch (err: any) {
    // ENOENT = file not found → normal, just start from 1
    // JSON parse error → corrupted → start from 1
    if (err.code !== 'ENOENT') {
      console.warn('Progress file corrupted or invalid → starting from page 1');
    }
  }

  // No valid progress → start from page 1
  console.log('No progress found → starting from page 1');
  return 1;
}
```

## 01. utils/text.ts – Text File Utils
```ts
import fs from 'fs/promises';
import path from 'path';

// ─────────────────────────────────────
// Shared: Ensure directory exists
export async function ensureDir(filePath: string): Promise<void> {
  await fs.mkdir(path.dirname(filePath), { recursive: true });
}
// ─────────────────────────────────────
// Progress Management
export interface Progress {
  currentPage: number;
  totalPages?: number;
  lastRun?: string;
}
// ─────────────────────────────────────
// Text file operations
export async function writeTextFile(filePath: string, content: string): Promise<void> {
  await ensureDir(filePath);
  await fs.writeFile(filePath, content, 'utf-8');
}

export async function appendTextFile(filePath: string, content: string): Promise<void> {
  await ensureDir(filePath);
  await fs.appendFile(filePath, content + '\n', 'utf-8');
}

export async function readTextFile(filePath: string): Promise<string> {
  return await fs.readFile(filePath, 'utf-8');
}
```

## 02. utils/csv.ts – Fast CSV Utils (2025 Standard)
```ts
import fs from 'fs/promises';
import path from 'path';
import { stringify } from 'csv-stringify/sync';
import { parse } from 'csv-parse/sync'; // ← sync is best for reading

// ─────────────────────────────────────
// Shared: Ensure dir + Progress
export async function ensureDir(filePath: string): Promise<void> {
  await fs.mkdir(path.dirname(filePath), { recursive: true });
}

export interface Progress {
  currentPage: number;
  lastRun?: string;
}
// ─────────────────────────────────────
// CSV: Write / Overwrite
export async function writeCsvFile<T extends Record<string, any>>(
  filePath: string,
  records: T[],
  header: { id: keyof T; title: string }[]
): Promise<void> {
  await ensureDir(filePath);
  const columns = header.map(h => ({ key: h.id as string, header: h.title }));
  const csv = stringify(records, { header: true, columns });
  await fs.writeFile(filePath, csv, 'utf-8');
}

// ─────────────────────────────────────
// CSV: Append
export async function appendToCsvFile<T extends Record<string, any>>(
  filePath: string,
  records: T[],
  header: { id: keyof T; title: string }[]
): Promise<void> {
  await ensureDir(filePath);
  const fileExists = await fs.stat(filePath).then(() => true).catch(() => false);
  const columns = header.map(h => ({ key: h.id as string, header: h.title }));
  const csv = stringify(records, { header: !fileExists, columns });
  await fs.appendFile(filePath, csv, 'utf-8');
}

// ─────────────────────────────────────
// CSV: Read – SIMPLE, FAST, NO ERRORS, 2025 STANDARD
export async function readCsvFile<T extends Record<string, any>>(
  filePath: string
): Promise<T[]> {
  try {
    const content = await fs.readFile(filePath, 'utf-8');

    // This is the correct return — NOT the parser!
    return parse(content, {
      columns: true,
      skip_empty_lines: true,
      trim: true,
    }) as T[];
  } catch (err: any) {
    if (err.code === 'ENOENT') {
      return []; // File doesn't exist → return empty array
    }
    throw err; // Other errors (corrupted file, etc.)
  }
}
```
## 03. utils/json.ts – JSON Utils (Perfect for Scrapers)
```ts
import fs from 'fs/promises';
import path from 'path';

// ─────────────────────────────────────
// Shared: Ensure dir + Progress
export async function ensureDir(filePath: string): Promise<void> {
  await fs.mkdir(path.dirname(filePath), { recursive: true });
}

// ─────────────────────────────────────
// JSON Helpers
export async function readJson<T>(filePath: string, defaultValue: T): Promise<T> {
  try {
    const data = await fs.readFile(filePath, 'utf-8');
    return JSON.parse(data) as T;
  } catch (err: any) {
    if (err.code === 'ENOENT') return defaultValue;
    throw err;
  }
}

export async function writeJson<T>(filePath: string, data: T): Promise<void> {
  await ensureDir(filePath);
  await fs.writeFile(filePath, JSON.stringify(data, null, 2), 'utf-8');
}

export async function appendJsonArray<T>(filePath: string, item: T): Promise<void> {
  const arr = await readJson<T[]>(filePath, []);
  arr.push(item);
  await writeJson(filePath, arr);
}

export async function updateJson<T extends object>(
  filePath: string,
  updater: (current: T) => T,
  defaultValue: T
): Promise<void> {
  const current = await readJson(filePath, defaultValue);
  await writeJson(filePath, updater(current));
}
```

## Example Uses
```ts
// scraper.ts
// scraper.ts – 100% WORKING VERSION
import { appendTextFile } from './utils/text';
import {
  appendToCsvFile,
  writeCsvFile,
  readCsvFile,
  loadProgress as loadCsvProgress,
  saveProgress as saveCsvProgress,
} from './utils/csv';
import {
  appendJsonArray,
  readJson,
  writeJson,
  loadProgress as loadJsonProgress,
  saveProgress as saveJsonProgress,
} from './utils/json';

// ─────────────────────────────────────
// 1. TEXT FILE: Save raw links
async function exampleTextFile() {
  const file = 'data/links.txt';
  const fakeLinks = [
    'https://notaires.fr/notaire/12345',
    'https://notaires.fr/notaire/67890',
    'https://notaires.fr/notaire/abcde',
  ];
  for (const link of fakeLinks) {
    await appendTextFile(file, link);
    console.log('Saved link:', link);
  }
  console.log('All links saved to data/links.txt\n');
}

// ─────────────────────────────────────
// 2. CSV: Append + Resume
interface Notaire {
  name: string;
  city: string;
  phone: string;
  email: string;
  url: string;
}

const CSV_FILE = 'data/notaires.csv';
const CSV_PROGRESS_FILE = 'data/progress-csv.json';

const header = [
  { id: 'name', title: 'Full Name' },
  { id: 'city', title: 'City' },
  { id: 'phone', title: 'Phone' },
  { id: 'email', title: 'Email' },
  { id: 'url', title: 'Profile URL' },
] as const;

async function exampleCsvWithResume() {
  const totalPages = 1932;
  let currentPage = await loadCsvProgress(totalPages, CSV_PROGRESS_FILE);

  console.log(`Starting CSV scraping from page ${currentPage}...`);

  for (; currentPage <= currentPage + 9 && currentPage <= totalPages; currentPage++) {
    const fakeData: Notaire[] = [
      {
        name: `Notaire ${currentPage}A`,
        city: 'Paris',
        phone: '+33123456789',
        email: `contact${currentPage}a@notaire.fr`,
        url: `https://notaires.fr/notaire/${currentPage}a`,
      },
      {
        name: `Notaire ${currentPage}B`,
        city: 'Lyon',
        phone: '+33456789012',
        email: `contact${currentPage}b@notaire.fr`,
        url: `https://notaires.fr/notaire/${currentPage}b`,
      },
    ];

    await appendToCsvFile(CSV_FILE, fakeData, header);
    await saveCsvProgress(CSV_PROGRESS_FILE, currentPage);

    console.log(`Page ${currentPage} saved → 2 notaires`);
  }
  console.log('CSV example done!\n');
}

// ─────────────────────────────────────
// 3. JSON: Append + Resume
interface Product {
  title: string;
  price: string;
  url: string;
  scrapedAt: string;
}

const JSON_FILE = 'data/products.json';
const JSON_PROGRESS_FILE = 'data/progress-json.json';

async function exampleJsonAppend() {
  let page = await loadJsonProgress(100, JSON_PROGRESS_FILE);

  console.log(`Starting JSON append from page ${page}...`);

  for (let i = 0; i < 5; i++, page++) {
    const product: Product = {
      title: `MacBook Pro ${page}`,
      price: `$${(2000 + page * 10)}`,
      url: `https://apple.com/macbook-${page}`,
      scrapedAt: new Date().toISOString(),
    };

    await appendJsonArray(JSON_FILE, product);
    await saveJsonProgress(JSON_PROGRESS_FILE, page);

    console.log(`Appended: ${product.title}`);
  }
  console.log('JSON example done!\n');
}

// ─────────────────────────────────────
// 4. Read everything back
async function exampleReadAll() {
  console.log('=== READING ALL DATA BACK ===\n');

  // Read text file
  try {
    const content = await import('fs/promises').then(m => m.readFile('data/links.txt', 'utf-8'));
    console.log('Links from TXT:');
    console.log(content.trimEnd());
  } catch {}

  // Read CSV
  const notaires = await readCsvFile<Notaire>(CSV_FILE);
  console.log(`\nLoaded ${notaires.length} notaires from CSV:`);
  console.table(notaires.slice(0, 3).map(n => ({ name: n.name, city: n.city })));

  // Read JSON
  const products = await readJson<Product[]>(JSON_FILE, []);
  console.log(`\nLoaded ${products.length} products from JSON:`);
  console.table(products.map(p => ({ title: p.title, price: p.price })));
}

// ─────────────────────────────────────
// Run everything
async function main() {
  await exampleTextFile();
  await exampleCsvWithResume();
  await exampleJsonAppend();
  await exampleReadAll();
  console.log('All examples completed! Check the data/ folder');
}

main().catch(console.error);
```

